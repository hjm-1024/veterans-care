<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´í›ˆì¼€ì–´ ë‚´ë¹„ê²Œì´í„° - ì§€ë„</title>
    
    <!-- ê¸°ì¡´ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/map-styles.css">
    
    <style>
        /* ê°„ë‹¨í•œ ë§µ ì „ìš© ìŠ¤íƒ€ì¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .map-header {
            height: 10vh;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            position: relative;
            z-index: 1000;
        }
        
        .map-header-content {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo-small h1 {
            color: #2c5aa0;
            font-size: 18px;
            font-weight: 700;
            margin: 0;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 8px 16px;
            border: 2px solid #2c5aa0;
            border-radius: 6px;
            background: white;
            color: #2c5aa0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background: #2c5aa0;
            color: white;
        }
        
        .nav-btn.primary {
            background: #2c5aa0;
            color: white;
        }
        
        .nav-btn.primary:hover {
            background: #1e3d72;
            border-color: #1e3d72;
        }
        
        .map-container {
            width: 100%;
            height: 90vh;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 250px;
            backdrop-filter: blur(10px);
        }
        
        .control-section {
            margin-bottom: 20px;
        }
        
        .control-section:last-child {
            margin-bottom: 0;
        }
        
        .control-section h3 {
            color: #2c5aa0;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .status-info {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2c5aa0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- ê°„ì†Œí™”ëœ í—¤ë” -->
    <header class="map-header">
        <div class="map-header-content">
            <div class="logo-small">
                <h1>ğŸ¥ ë³´í›ˆì¼€ì–´ ë‚´ë¹„ê²Œì´í„°</h1>
            </div>
            <nav class="nav-buttons">
                <a href="index.html" class="nav-btn">ğŸ  ë©”ì¸</a>
                <button onclick="getUserLocation()" class="nav-btn primary" id="locationBtn">
                    ğŸ“ ë‚´ ìœ„ì¹˜
                </button>
            </nav>
        </div>
    </header>

    <!-- ë©”ì¸ ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div class="map-container">
        <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
        
        <!-- ì§€ë„ -->
        <div id="map"></div>
        
        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="map-controls">
            <div class="control-section">
                <h3>ğŸ—º ì§€ë„ ìƒíƒœ</h3>
                <div id="map-status" class="status-info">ì§€ë„ ë¡œë”© ì¤‘...</div>
            </div>
            
            <div class="control-section">
                <h3>ğŸ“ ìœ„ì¹˜ ì •ë³´</h3>
                <div id="location-status" class="status-info">ìœ„ì¹˜ ì •ë³´ ì—†ìŒ</div>
            </div>
            
            <div class="control-section">
                <h3>ğŸ¥ ë³‘ì› ì •ë³´</h3>
                <div id="hospital-status" class="status-info">ë³‘ì› ì •ë³´ ì—†ìŒ</div>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • íŒŒì¼ ë¨¼ì € ë¡œë“œ -->
    <script src="config.js"></script>
    
    <!-- ì¹´ì¹´ì˜¤ë§µ API (ì§ì ‘ ë¡œë”©) -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=796a42e6ccbb3a6ae2f7268a24f574ee&libraries=services"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let map = null;
        let userLocation = null;
        let selectedHospital = null;
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updateMapStatus(message, isSuccess = true) {
            const statusEl = document.getElementById('map-status');
            statusEl.textContent = message;
            statusEl.className = `status-info ${isSuccess ? 'status-success' : 'status-error'}`;
        }
        
        function updateLocationStatus(message, isSuccess = true) {
            const statusEl = document.getElementById('location-status');
            statusEl.textContent = message;
            statusEl.className = `status-info ${isSuccess ? 'status-success' : 'status-error'}`;
        }
        
        function updateHospitalStatus(message, isSuccess = true) {
            const statusEl = document.getElementById('hospital-status');
            statusEl.textContent = message;
            statusEl.className = `status-info ${isSuccess ? 'status-success' : 'status-error'}`;
        }
        
        // ì§€ë„ ì´ˆê¸°í™” (ì¹´ì¹´ì˜¤ ë ˆí¼ëŸ°ìŠ¤ ê¸°ë°˜)
        function initializeMap() {
            try {
                console.log('ğŸ—º ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
                
                const container = document.getElementById('map');
                const options = {
                    center: new kakao.maps.LatLng(36.5, 127.5), // í•œêµ­ ì¤‘ì‹¬
                    level: 8
                };

                map = new kakao.maps.Map(container, options);
                
                // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
                document.getElementById('loading-overlay').style.display = 'none';
                
                console.log('âœ… ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
                updateMapStatus('ì§€ë„ ë¡œë”© ì™„ë£Œ', true);
                
                // ì‚¬ìš©ì ìœ„ì¹˜ ìë™ ìš”ì²­
                setTimeout(() => {
                    getUserLocation();
                }, 1000);
                
                // URL íŒŒë¼ë¯¸í„° ì²˜ë¦¬
                processUrlParameters();
                
            } catch (error) {
                console.error('âŒ ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                updateMapStatus('ì§€ë„ ë¡œë”© ì‹¤íŒ¨: ' + error.message, false);
                useAlternativeMap();
            }
        }
        
        // ì‚¬ìš©ì ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° (HTTPS ë¬¸ì œ ëŒ€ì‘)
        function getUserLocation() {
            console.log('ğŸ“ ì‚¬ìš©ì ìœ„ì¹˜ ìš”ì²­ ì‹œì‘');
            
            const locationBtn = document.getElementById('locationBtn');
            const originalText = locationBtn.innerHTML;
            
            // HTTPS ì²´í¬
            const isHttps = window.location.protocol === 'https:';
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            
            if (!navigator.geolocation) {
                updateLocationStatus('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', false);
                showLocationAlternatives();
                return;
            }
            
            if (!isHttps && !isLocalhost) {
                updateLocationStatus('âš ï¸ HTTPS í™˜ê²½ì—ì„œë§Œ ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', false);
                showLocationAlternatives();
                return;
            }
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            locationBtn.innerHTML = 'ğŸ”„ ìœ„ì¹˜ ì°¾ëŠ” ì¤‘...';
            locationBtn.disabled = true;
            updateLocationStatus('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...', true);
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    console.log('âœ… ì‚¬ìš©ì ìœ„ì¹˜ íšë“:', userLocation);
                    updateLocationStatus(`ìœ„ì¹˜: ${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}`, true);
                    
                    // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                    if (map) {
                        const userPos = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
                        map.setCenter(userPos);
                        map.setLevel(5);
                        
                        // ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€
                        const marker = new kakao.maps.Marker({
                            position: userPos,
                            map: map
                        });
                        
                        const infowindow = new kakao.maps.InfoWindow({
                            content: '<div style="padding:5px;">ğŸ“ ë‚´ ìœ„ì¹˜</div>'
                        });
                        infowindow.open(map, marker);
                    }
                    
                    // ë²„íŠ¼ ë³µì›
                    locationBtn.innerHTML = 'âœ… ìœ„ì¹˜ í™•ì¸ë¨';
                    setTimeout(() => {
                        locationBtn.innerHTML = originalText;
                        locationBtn.disabled = false;
                    }, 3000);
                },
                (error) => {
                    console.error('âŒ ìœ„ì¹˜ íšë“ ì‹¤íŒ¨:', error);
                    
                    let errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'ìœ„ì¹˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                            break;
                    }
                    
                    updateLocationStatus(errorMessage, false);
                    showLocationAlternatives();
                    
                    // ë²„íŠ¼ ë³µì›
                    locationBtn.innerHTML = 'âŒ ìœ„ì¹˜ ì‹¤íŒ¨';
                    setTimeout(() => {
                        locationBtn.innerHTML = originalText;
                        locationBtn.disabled = false;
                    }, 3000);
                },
                {
                    enableHighAccuracy: false, // HTTPS ë¬¸ì œ ì™„í™”
                    timeout: 15000,
                    maximumAge: 300000 // 5ë¶„ ìºì‹œ
                }
            );
        }
        
        // ìœ„ì¹˜ ëŒ€ì•ˆ ì˜µì…˜ í‘œì‹œ
        function showLocationAlternatives() {
            const locationSection = document.querySelector('.control-section:nth-child(2)');
            
            if (!document.getElementById('location-alternatives')) {
                const alternativesDiv = document.createElement('div');
                alternativesDiv.id = 'location-alternatives';
                alternativesDiv.innerHTML = `
                    <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; font-size: 12px;">
                        <strong>ğŸ“ ìœ„ì¹˜ ì„¤ì • ë°©ë²•:</strong><br>
                        <button onclick="useDefaultLocation()" style="margin: 5px 2px; padding: 4px 8px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">ì„œìš¸ ê¸°ë³¸ìœ„ì¹˜</button>
                        <button onclick="useHospitalLocation()" style="margin: 5px 2px; padding: 4px 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">ë³‘ì› ìœ„ì¹˜ë¡œ</button>
                        <button onclick="showManualLocation()" style="margin: 5px 2px; padding: 4px 8px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">ì§ì ‘ ì…ë ¥</button>
                    </div>
                `;
                locationSection.appendChild(alternativesDiv);
            }
        }
        
        // ê¸°ë³¸ ìœ„ì¹˜ ì‚¬ìš© (ì„œìš¸)
        function useDefaultLocation() {
            userLocation = { lat: 37.5665, lng: 126.9780 }; // ì„œìš¸ì‹œì²­
            updateLocationStatus('ê¸°ë³¸ ìœ„ì¹˜: ì„œìš¸ì‹œì²­', true);
            
            if (map) {
                const pos = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
                map.setCenter(pos);
                map.setLevel(5);
                
                const marker = new kakao.maps.Marker({
                    position: pos,
                    map: map
                });
                
                const infowindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding:5px;">ğŸ“ ê¸°ë³¸ ìœ„ì¹˜ (ì„œìš¸)</div>'
                });
                infowindow.open(map, marker);
            }
        }
        
        // ë³‘ì› ìœ„ì¹˜ë¥¼ ì‚¬ìš©ì ìœ„ì¹˜ë¡œ ì„¤ì •
        function useHospitalLocation() {
            if (selectedHospital && selectedHospital.lat && selectedHospital.lng) {
                userLocation = { lat: selectedHospital.lat, lng: selectedHospital.lng };
                updateLocationStatus(`ë³‘ì› ìœ„ì¹˜: ${selectedHospital.name}`, true);
            } else {
                updateLocationStatus('ë³‘ì› ìœ„ì¹˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.', false);
            }
        }
        
        // ìˆ˜ë™ ìœ„ì¹˜ ì…ë ¥
        function showManualLocation() {
            const lat = prompt('ìœ„ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 37.5665)');
            const lng = prompt('ê²½ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 126.9780)');
            
            if (lat && lng && !isNaN(lat) && !isNaN(lng)) {
                userLocation = { lat: parseFloat(lat), lng: parseFloat(lng) };
                updateLocationStatus(`ìˆ˜ë™ ì…ë ¥: ${lat}, ${lng}`, true);
                
                if (map) {
                    const pos = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
                    map.setCenter(pos);
                    map.setLevel(5);
                    
                    const marker = new kakao.maps.Marker({
                        position: pos,
                        map: map
                    });
                    
                    const infowindow = new kakao.maps.InfoWindow({
                        content: '<div style="padding:5px;">ğŸ“ ìˆ˜ë™ ì…ë ¥ ìœ„ì¹˜</div>'
                    });
                    infowindow.open(map, marker);
                }
            } else {
                updateLocationStatus('ì˜ëª»ëœ ì¢Œí‘œì…ë‹ˆë‹¤.', false);
            }
        }
        
        // URL íŒŒë¼ë¯¸í„° ì²˜ë¦¬
        function processUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const hospitalId = urlParams.get('hospital');
            const hospitalName = urlParams.get('name');
            const hospitalLat = parseFloat(urlParams.get('lat'));
            const hospitalLng = parseFloat(urlParams.get('lng'));
            
            if (hospitalId && hospitalName) {
                console.log('ğŸ¥ íŠ¹ì • ë³‘ì› í‘œì‹œ:', hospitalName);
                updateHospitalStatus(`ë³‘ì›: ${hospitalName}`, true);
                
                if (hospitalLat && hospitalLng && !isNaN(hospitalLat) && !isNaN(hospitalLng)) {
                    // ë³‘ì› ìœ„ì¹˜ë¡œ ì§€ë„ ì´ë™
                    const hospitalPos = new kakao.maps.LatLng(hospitalLat, hospitalLng);
                    map.setCenter(hospitalPos);
                    map.setLevel(3);
                    
                    // ë³‘ì› ë§ˆì»¤ ì¶”ê°€
                    const marker = new kakao.maps.Marker({
                        position: hospitalPos,
                        map: map
                    });
                    
                    const infowindow = new kakao.maps.InfoWindow({
                        content: `<div style="padding:10px;"><strong>ğŸ¥ ${hospitalName}</strong><br><button onclick="startNavigation('${hospitalName}', ${hospitalLat}, ${hospitalLng})" style="margin-top:5px; padding:5px 10px; background:#2c5aa0; color:white; border:none; border-radius:4px; cursor:pointer;">ê¸¸ì°¾ê¸°</button></div>`
                    });
                    infowindow.open(map, marker);
                    
                    selectedHospital = {
                        id: hospitalId,
                        name: hospitalName,
                        lat: hospitalLat,
                        lng: hospitalLng
                    };
                } else {
                    updateHospitalStatus(`ë³‘ì›: ${hospitalName} (ì¢Œí‘œ ì—†ìŒ)`, false);
                }
            }
        }
        
        // ê¸¸ì°¾ê¸° ì‹œì‘ (ê°œì„ ëœ ë²„ì „)
        function startNavigation(hospitalName, lat, lng) {
            if (!userLocation) {
                alert('ë¨¼ì € ë‚´ ìœ„ì¹˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                getUserLocation();
                return;
            }
            
            // ì‚¬ìš©ì ìœ„ì¹˜ì—ì„œ ë³‘ì›ê¹Œì§€ì˜ ê±°ë¦¬ ê³„ì‚°
            const distance = calculateDistance(userLocation.lat, userLocation.lng, lat, lng);
            const distanceText = distance < 1 ? `${Math.round(distance * 1000)}m` : `${distance.toFixed(1)}km`;
            
            // ë„¤ë¹„ê²Œì´ì…˜ ì˜µì…˜ í‘œì‹œ
            const navOptions = `
                <div style="text-align: center; padding: 10px;">
                    <h3>ğŸ—ºï¸ ê¸¸ì°¾ê¸° ì•± ì„ íƒ</h3>
                    <p><strong>${hospitalName}</strong> (ì•½ ${distanceText})</p>
                    <div style="margin: 10px 0;">
                        <button onclick="openNavigation('kakao', '${hospitalName}', ${lat}, ${lng})" class="nav-btn" style="margin: 5px;">ì¹´ì¹´ì˜¤ë§µ</button>
                        <button onclick="openNavigation('naver', '${hospitalName}', ${lat}, ${lng})" class="nav-btn" style="margin: 5px;">ë„¤ì´ë²„ë§µ</button>
                        <button onclick="openNavigation('google', '${hospitalName}', ${lat}, ${lng})" class="nav-btn" style="margin: 5px;">êµ¬ê¸€ë§µ</button>
                    </div>
                    <button onclick="closeNavigationModal()" class="nav-btn" style="background: #6c757d; margin-top: 10px;">ì·¨ì†Œ</button>
                </div>
            `;
            
            // ëª¨ë‹¬ í‘œì‹œ
            showModal(navOptions);
        }
        
        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (Haversine formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // íŠ¹ì • ë„¤ë¹„ê²Œì´ì…˜ ì•±ìœ¼ë¡œ ì—´ê¸°
        function openNavigation(service, hospitalName, lat, lng) {
            const config = window.VeteransCareConfig;
            let url = '';
            
            switch(service) {
                case 'kakao':
                    url = `${config.navigation.kakao.web}/${encodeURIComponent(hospitalName)},${lat},${lng}`;
                    break;
                case 'naver':
                    url = `${config.navigation.naver.web}?c=${lng},${lat},${encodeURIComponent(hospitalName)}`;
                    break;
                case 'google':
                    url = `${config.navigation.google.web}/${userLocation.lat},${userLocation.lng}/${lat},${lng}`;
                    break;
            }
            
            if (url) {
                window.open(url, '_blank');
                closeNavigationModal();
            }
        }
        
        // ëª¨ë‹¬ í‘œì‹œ
        function showModal(content) {
            const modal = document.createElement('div');
            modal.id = 'navigation-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 3000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 20px;
                border-radius: 12px;
                max-width: 400px;
                width: 90%;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            modalContent.innerHTML = content;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeNavigationModal() {
            const modal = document.getElementById('navigation-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ëŒ€ì•ˆ ì§€ë„ ì‚¬ìš© (OpenStreetMap ê¸°ë°˜ - API í‚¤ ë¶ˆí•„ìš”)
        function useAlternativeMap() {
            document.getElementById('loading-overlay').style.display = 'none';
            updateMapStatus('OpenStreetMapìœ¼ë¡œ ì „í™˜ë¨', true);
            
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë³‘ì› ì •ë³´ ì¶”ì¶œ
            const urlParams = new URLSearchParams(window.location.search);
            const hospitalName = decodeURIComponent(urlParams.get('name') || 'ë³‘ì›');
            const hospitalLat = parseFloat(urlParams.get('lat')) || 36.5;
            const hospitalLng = parseFloat(urlParams.get('lng')) || 127.5;
            
            // OpenStreetMap iframe ìƒì„± (API í‚¤ ë¶ˆí•„ìš”)
            const mapContainer = document.getElementById('map');
            mapContainer.innerHTML = `
                <div style="width: 100%; height: 100%; position: relative; background: #f0f0f0;">
                    <iframe 
                        width="100%" 
                        height="100%" 
                        frameborder="0" 
                        style="border:0"
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${hospitalLng-0.01},${hospitalLat-0.01},${hospitalLng+0.01},${hospitalLat+0.01}&layer=mapnik&marker=${hospitalLat},${hospitalLng}"
                        allowfullscreen>
                    </iframe>
                    <div style="position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 8px; font-size: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        ğŸ“ ${hospitalName}<br>
                        <small>ìœ„ë„: ${hospitalLat.toFixed(4)}, ê²½ë„: ${hospitalLng.toFixed(4)}</small>
                    </div>
                </div>
            `;
            
            updateHospitalStatus(`ë³‘ì›: ${hospitalName} (OpenStreetMap)`, true);
            
            // ê¸¸ì°¾ê¸° ë²„íŠ¼ ì¶”ê°€
            const controlsDiv = document.querySelector('.map-controls');
            if (!document.getElementById('alternative-navigation')) {
                const navSection = document.createElement('div');
                navSection.className = 'control-section';
                navSection.innerHTML = `
                    <h3>ğŸ—ºï¸ ê¸¸ì°¾ê¸° ì˜µì…˜</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <button onclick="openGoogleMapsNavigation('${hospitalName}', ${hospitalLat}, ${hospitalLng})" 
                                class="nav-btn" style="width: 100%; padding: 8px;">
                            ğŸ” Google Mapsë¡œ ë³´ê¸°
                        </button>
                        <button onclick="openNaverMapNavigation('${hospitalName}', ${hospitalLat}, ${hospitalLng})" 
                                class="nav-btn" style="width: 100%; padding: 8px;">
                            ğŸ—ºï¸ ë„¤ì´ë²„ì§€ë„ë¡œ ë³´ê¸°
                        </button>
                        <button onclick="openKakaoMapNavigation('${hospitalName}', ${hospitalLat}, ${hospitalLng})" 
                                class="nav-btn" style="width: 100%; padding: 8px;">
                            ğŸ›£ï¸ ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ë³´ê¸°
                        </button>
                    </div>
                `;
                controlsDiv.appendChild(navSection);
            }
        }
        
        // ë‹¤ì–‘í•œ ì§€ë„ ì„œë¹„ìŠ¤ë¡œ ê¸¸ì°¾ê¸° (API í‚¤ ë¶ˆí•„ìš”)
        function openGoogleMapsNavigation(hospitalName, lat, lng) {
            const googleUrl = `https://www.google.com/maps/search/${encodeURIComponent(hospitalName)}/@${lat},${lng},15z`;
            window.open(googleUrl, '_blank');
        }
        
        function openNaverMapNavigation(hospitalName, lat, lng) {
            const naverUrl = `https://map.naver.com/v5/search/${encodeURIComponent(hospitalName)}`;
            window.open(naverUrl, '_blank');
        }
        
        function openKakaoMapNavigation(hospitalName, lat, lng) {
            const kakaoUrl = `https://map.kakao.com/link/search/${encodeURIComponent(hospitalName)}`;
            window.open(kakaoUrl, '_blank');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
            
            // ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ í™•ì¸ ë° ì´ˆê¸°í™”
            if (typeof kakao !== 'undefined' && kakao.maps) {
                console.log('âœ… ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ í™•ì¸');
                initializeMap();
            } else if (typeof kakao !== 'undefined') {
                console.log('ğŸ”„ ì¹´ì¹´ì˜¤ë§µ API ë¡œë”© ëŒ€ê¸° ì¤‘...');
                kakao.maps.load(function() {
                    console.log('âœ… ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì™„ë£Œ');
                    initializeMap();
                });
            } else {
                console.error('âŒ ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                console.log('ğŸ”„ ëŒ€ì•ˆ ì§€ë„ë¡œ ì „í™˜í•©ë‹ˆë‹¤.');
                useAlternativeMap();
            }
        };
    </script>
</body>
</html>